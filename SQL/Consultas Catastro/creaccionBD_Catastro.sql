--- script de creacción de la base de datos CATASTRO

CREATE DATABASE CATASTRO
GO

USE CATASTRO

CREATE TABLE ZONAURBANA (
	NOMBREZONA VARCHAR(25),
	DESCRIPCIÓN VARCHAR(150),
	NUMPARQUES TINYINT,
	OBSERVACIONES VARCHAR(200),
	CONSTRAINT PK_ZONAURBANA PRIMARY KEY (NOMBREZONA),
	CONSTRAINT CK_ZONAURBANA_NUMPARQUES CHECK(NUMPARQUES>=0));

CREATE TABLE VIVIENDA (
	CALLE VARCHAR(40),
	NUMERO SMALLINT,
	TIPOVIVIENDA VARCHAR(6) NOT NULL,
	CODIGOPOSTAL CHAR(5),
	METROSSOLAR SMALLINT,
	NOMBREZONA VARCHAR(25) NOT NULL,
	CONSTRAINT PK_VIVIENDA PRIMARY KEY (CALLE,NUMERO),
	CONSTRAINT FK_VIVIENDA_ZONAURBANA FOREIGN KEY(NOMBREZONA) REFERENCES ZONAURBANA(NOMBREZONA),
	CONSTRAINT CK_VIVIENDA_TIPO CHECK(TIPOVIVIENDA IN ('Bloque','Casa')),
	CONSTRAINT CK_VIVIENDA_CODIGOPOSTAL CHECK (CODIGOPOSTAL LIKE '[0-9][0-9][0-9][0-9][0-9]'),
	CONSTRAINT CK_VIVIENDA_METROSSOLAR CHECK(METROSSOLAR>0));

CREATE TABLE BLOQUEPISOS (
	CALLE VARCHAR(40),
	NUMERO SMALLINT,
	NUMPISOS TINYINT NOT NULL,
	ASCENSOR CHAR(1),
	CONSTRAINT PK_BLOQUEPISOS PRIMARY KEY (CALLE,NUMERO),
	CONSTRAINT FK_BLOQUEPISOS_VIVIENDA FOREIGN KEY (CALLE,NUMERO) REFERENCES VIVIENDA (CALLE,NUMERO),
	CONSTRAINT CK_BLOQUEPISOS_NUMPISOS CHECK (NUMPISOS>0),
	CONSTRAINT CK_BLOQUEPISOS_ASCENSOR CHECK (ASCENSOR IN ('S','N')))

CREATE TABLE PROPIETARIO (
	DNI CHAR(9) NOT NULL,
	NOMBRE VARCHAR(20) NOT NULL,
	APELLIDO1 VARCHAR(25) NOT NULL,
	APELLIDO2 VARCHAR(25) NULL,
	SEXO CHAR(1),
	TELEFONO CHAR(9),
	CONSTRAINT PK_PROPIETARIO PRIMARY KEY (DNI),
	CONSTRAINT CK_PROPIETARIO_SEXO CHECK (SEXO IN ('H','M')),
	CONSTRAINT CK_PROPIETARIO_DNI CHECK (DNI LIKE '[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][A-Z]'),
	CONSTRAINT CK_PROPIETARIO_TELEFONO CHECK (TELEFONO LIKE '[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]'))


CREATE TABLE PISO (
	CALLE VARCHAR(40) NOT NULL,
	NUMERO SMALLINT NOT NULL,
	PLANTA TINYINT NOT NULL,
	PUERTA CHAR(1) NOT NULL,
	NUMHABITACIONES	TINYINT,
	METROSUTILES SMALLINT,
	METROSCONSTRUIDOS SMALLINT,
	DNIPROPIETARIO CHAR(9),
	CONSTRAINT PK_PISO PRIMARY KEY (CALLE,NUMERO, PLANTA, PUERTA),
	CONSTRAINT FK_PISO_BLOQUEPISOS FOREIGN KEY (CALLE, NUMERO) REFERENCES BLOQUEPISOS (CALLE, NUMERO),
	CONSTRAINT FK_PISO_PROPIETARIO FOREIGN KEY (DNIPROPIETARIO) REFERENCES PROPIETARIO (DNI),
	CONSTRAINT CK_PISO_NUMHABITACIONES CHECK(NUMHABITACIONES>0),
	CONSTRAINT CK_PISO_METROSUTILES CHECK (METROSUTILES>0),
	CONSTRAINT CK_PISO_METROSCONSTRUIDOS CHECK (METROSCONSTRUIDOS>=METROSUTILES))

CREATE TABLE HUECO (
	CODIGO SMALLINT NOT NULL,
	CALLE VARCHAR(40) NOT NULL,
	NUMERO SMALLINT NOT NULL,
	PLANTA TINYINT,
	PUERTA CHAR(1),
	ID_HUECO TINYINT,
	TIPO VARCHAR(10) NOT NULL,
	METROS FLOAT,
	DNIPROPIETARIO CHAR(9),
	OBSERVACIONES VARCHAR(150),
	CONSTRAINT PK_HUECO PRIMARY KEY (CODIGO),
	CONSTRAINT FK_HUECO_BLOQUEPISOS FOREIGN KEY (CALLE, NUMERO) REFERENCES BLOQUEPISOS (CALLE, NUMERO),
	CONSTRAINT FK_HUECO_PISO FOREIGN KEY (CALLE, NUMERO, PLANTA, PUERTA) REFERENCES PISO (CALLE, NUMERO, PLANTA, PUERTA),
	CONSTRAINT FK_HUECO_PROPIETARIO FOREIGN KEY (DNIPROPIETARIO) REFERENCES PROPIETARIO (DNI),
	CONSTRAINT CK_HUECO_METROS CHECK(METROS>0),
	CONSTRAINT CK_HUECO_TIPO CHECK (TIPO IN ('GARAJE', 'TRASTERO', 'BODEGA')))


CREATE TABLE CASAPARTICULAR (
	CALLE VARCHAR(40) NOT NULL,
	NUMERO SMALLINT NOT NULL,
	NUMPLANTAS TINYINT NOT NULL,
	PISCINA CHAR(1),
	METROSCONSTRUIDOS SMALLINT,
	DNIPROPIETARIO CHAR(9),
	CONSTRAINT PK_CASAPARTICULAR PRIMARY KEY (CALLE,NUMERO),
	CONSTRAINT FK_CASAPARTICULAR_VIVIENDA FOREIGN KEY (CALLE, NUMERO) REFERENCES VIVIENDA (CALLE, NUMERO),
	CONSTRAINT FK_CASAPARTICULAR_PROPIETARIO FOREIGN KEY (DNIPROPIETARIO) REFERENCES PROPIETARIO (DNI),
	CONSTRAINT CK_CASAPARTICULAR_PISCINA CHECK (PISCINA IN ('S','N')),
	CONSTRAINT CK_CASAPARTICULAR_METROSCONSTRUIDOS CHECK (METROSCONSTRUIDOS>0))

--- insertar datos en la base de datos	


INSERT INTO ZONAURBANA VALUES('Atocha','Casco histórico',2,'5 hab/km2');
INSERT INTO ZONAURBANA VALUES('Cantarranas','Zona centro',2,NULL);
INSERT INTO ZONAURBANA VALUES('Centro','Zona centro',3,'Ocupación del 30 %');
INSERT INTO ZONAURBANA VALUES('Cuatrovientos','Este',3,NULL);
INSERT INTO ZONAURBANA VALUES('Palomar','Primer Cinturón',1,NULL);
INSERT INTO ZONAURBANA VALUES('La solana','Primer Cinturón',1,NULL);

INSERT INTO VIVIENDA VALUES('Alegria',44,'Bloque','23705',535,'La solana');
INSERT INTO VIVIENDA VALUES('Damasco',3,'Bloque','23900',390,'Atocha');
INSERT INTO VIVIENDA VALUES('Damasco',6,'Casa','23900',200,'Atocha');
INSERT INTO VIVIENDA VALUES('Damasco',7,'Casa','23900',210,'Atocha');
INSERT INTO VIVIENDA VALUES('General Mola',22,'Casa','23800',200,'Centro');
INSERT INTO VIVIENDA VALUES('Laredo',3,'Bloque','23700',450,'Cuatrovientos');
INSERT INTO VIVIENDA VALUES('Luca de Tena',22,'Bloque','23701',560,'Centro');
INSERT INTO VIVIENDA VALUES('Luna',12,'Casa','23710',190,'Palomar');
INSERT INTO VIVIENDA VALUES('Pasión',3,'Casa','23801',570,'Centro');
INSERT INTO VIVIENDA VALUES('Rua nova',25,'Casa','23800',403,'Centro');
INSERT INTO VIVIENDA VALUES('Sol',5,'Bloque','23710',628,'Palomar');
INSERT INTO VIVIENDA VALUES('Zurbarán',101,'Bloque','23700',430,'Cuatrovientos');


INSERT INTO PROPIETARIO VALUES('11111122A','Javier','López','Díaz','H','696000111');
INSERT INTO PROPIETARIO VALUES('22222211B','Lucas','López','Sánchez','H','969991199');
INSERT INTO PROPIETARIO VALUES('33333344C','María','Rodríguez','Ramos','M','787878787');
INSERT INTO PROPIETARIO VALUES('44332244K','Sara María','Vega','Varela','M',NULL);
INSERT INTO PROPIETARIO VALUES('44443223D','Ana','Alcalá','López','M','565665544');
INSERT INTO PROPIETARIO VALUES('55555511E','María','Galán','Sánchez','M','696112211');
INSERT INTO PROPIETARIO VALUES('55999911R','Malena','Franco','Valiño','M','888802211');
INSERT INTO PROPIETARIO VALUES('66666677F','Mónica','Rodríguez','Tena','M','606000011');
INSERT INTO PROPIETARIO VALUES('77777788G','Manolo','Ramos','Galán','H','656555555');
INSERT INTO PROPIETARIO VALUES('88888822H','Elena','González','de la Sierra','M','655443322');
INSERT INTO PROPIETARIO VALUES('99999933J','George','Sting',NULL,'H','610000111');
INSERT INTO PROPIETARIO VALUES('99999966L','Jorge Juan','Arranz','Pérez','H','610123123');
INSERT INTO PROPIETARIO VALUES('99888888M','Felipe','Estévez','Carro','H','610655556');
INSERT INTO PROPIETARIO VALUES('99995555N','Pepe Juan','Vila','Jiménez','H','620000123');
INSERT INTO PROPIETARIO VALUES('99994444P','Ana Isabel','Vila','Pérez','H','688883123');

INSERT INTO CASAPARTICULAR VALUES('Damasco',6,1,'N',140,'11111122A');
INSERT INTO CASAPARTICULAR VALUES('Damasco',7,2,'N',155,'99999933J');
INSERT INTO CASAPARTICULAR VALUES('General Mola',22,2,'S',200,'22222211B');
INSERT INTO CASAPARTICULAR VALUES('Luna',12,1,'S',200,'11111122A');
INSERT INTO CASAPARTICULAR VALUES('Pasión',3,3,'N',160,'33333344C');
INSERT INTO CASAPARTICULAR VALUES('Rua nova',25,1,'N',307,'44332244K');


INSERT INTO BLOQUEPISOS VALUES('Alegria',44,11,'N');
INSERT INTO BLOQUEPISOS VALUES('Damasco',3,22,'S');
INSERT INTO BLOQUEPISOS VALUES('Laredo',3,12,'N');
INSERT INTO BLOQUEPISOS VALUES('Luca de Tena',22,20,'S');
INSERT INTO BLOQUEPISOS VALUES('Sol',5,12,'S');
INSERT INTO BLOQUEPISOS VALUES('Zurbarán',101,56,'S');


INSERT INTO PISO VALUES('Alegria',44,1,'A',1,45,52,'88888822H');
INSERT INTO PISO VALUES('Alegria',44,1,'B',2,58,65,'88888822H');
INSERT INTO PISO VALUES('Alegria',44,2,'A',1,45,52,'22222211B');
INSERT INTO PISO VALUES('Damasco',3,1,'A',4,125,140,'11111122A');
INSERT INTO PISO VALUES('Damasco',3,1,'B',3,90,98,'22222211B');
INSERT INTO PISO VALUES('Damasco',3,1,'C',3,85,92,'11111122A');
INSERT INTO PISO VALUES('Damasco',3,2,'A',1,40,45,'33333344C');
INSERT INTO PISO VALUES('Damasco',3,2,'B',4,225,240,'99999966L');
INSERT INTO PISO VALUES('Damasco',3,3,'A',1,65,69,'11111122A');
INSERT INTO PISO VALUES('Damasco',3,3,'B',4,125,140,'55555511E');
INSERT INTO PISO VALUES('Damasco',3,4,'A',2,75,80,'55555511E');
INSERT INTO PISO VALUES('Damasco',3,4,'B',3,93,101,'33333344C');
INSERT INTO PISO VALUES('Laredo',3,1,'A',5,196,205,'99994444P');
INSERT INTO PISO VALUES('Laredo',3,1,'B',6,249,259,'99995555N');
INSERT INTO PISO VALUES('Laredo',3,2,'A',5,196,205,'99995555N');
INSERT INTO PISO VALUES('Laredo',3,2,'B',3,96,105,'99999966L');
INSERT INTO PISO VALUES('Laredo',3,2,'C',2,79,85,'99994444P');
INSERT INTO PISO VALUES('Laredo',3,3,'A',7,286,296,'99888888M');
INSERT INTO PISO VALUES('Luca de Tena',22,1,'A',4,220,230,'44443223D');
INSERT INTO PISO VALUES('Luca de Tena',22,1,'B',2,70,73,'44332244K');
INSERT INTO PISO VALUES('Luca de Tena',22,2,'A',4,180,190,'55999911R');
INSERT INTO PISO VALUES('Sol',5,1,'A',2,69,74,'55999911R');
INSERT INTO PISO VALUES('Sol',5,2,'A',2,69,74,'55999911R');
INSERT INTO PISO VALUES('Sol',5,2,'B',1,49,54,'99999933J');
INSERT INTO PISO VALUES('Zurbarán',101,1,'A',3,105,112,'44332244K');
INSERT INTO PISO VALUES('Zurbarán',101,2,'B',3,102,109,'44443223D');
INSERT INTO PISO VALUES('Zurbarán',101,5,'A',2,87,93,'66666677F');
INSERT INTO PISO VALUES('Zurbarán',101,5,'B',3,89,97,'88888822H');


INSERT INTO HUECO VALUES(1,'Zurbarán',101,5,'B',11,'GARAJE',14,'88888822H',NULL);
INSERT INTO HUECO VALUES(2,'Zurbarán',101,5,'B',20,'GARAJE',13.75,'88888822H',NULL);
INSERT INTO HUECO VALUES(3,'Zurbarán',101,5,'B',11,'BODEGA',14.5,'88888822H',NULL);
INSERT INTO HUECO VALUES(4,'Zurbarán',101,5,'A',12,'GARAJE',14,'66666677F',NULL);
INSERT INTO HUECO VALUES(5,'Zurbarán',101,2,'B',13,'BODEGA',9,'44443223D',NULL);
INSERT INTO HUECO VALUES(6,'Zurbarán',101,2,'B',13,'GARAJE',14,'44443223D',NULL);
INSERT INTO HUECO VALUES(7,'Zurbarán',101,1,'A',14,'GARAJE',14.75,'44332244K',NULL);
INSERT INTO HUECO VALUES(8,'Zurbarán',101,NULL,NULL,44,'GARAJE',14.4,NULL,NULL);
INSERT INTO HUECO VALUES(9,'Sol',5,2,'A',2,'TRASTERO',11.4,'55999911R','Tiene una ventana grande');
INSERT INTO HUECO VALUES(10,'Sol',5,2,'B',3,'TRASTERO',12.8,'99999933J','Tiene enchufe');
INSERT INTO HUECO VALUES(11,'Luca de Tena',22,1,'A',1,'GARAJE',15.2,'44443223D',NULL);
INSERT INTO HUECO VALUES(12,'Luca de Tena',22,1,'B',2,'GARAJE',15.5,'44332244K',NULL);
INSERT INTO HUECO VALUES(13,'Luca de Tena',22,2,'A',3,'GARAJE',14.3,'55999911R',NULL);
INSERT INTO HUECO VALUES(14,'Luca de Tena',22,1,'B',20,'BODEGA',8.5,'44332244K',NULL);
INSERT INTO HUECO VALUES(15,'Laredo',3,1,'A',1,'GARAJE',15.2,'99994444P',NULL);
INSERT INTO HUECO VALUES(16,'Laredo',3,1,'B',2,'GARAJE',15.2,'99995555N',NULL);
INSERT INTO HUECO VALUES(20,'Laredo',3,1,'B',21,'GARAJE',16.3,'99995555N',NULL);
INSERT INTO HUECO VALUES(21,'Laredo',3,1,'B',23,'GARAJE',13.8,'99995555N',NULL);
INSERT INTO HUECO VALUES(17,'Laredo',3,2,'A',3,'GARAJE',15,'99995555N',NULL);
INSERT INTO HUECO VALUES(18,'Laredo',3,2,'C',4,'GARAJE',15,'99994444P',NULL);
INSERT INTO HUECO VALUES(19,'Laredo',3,3,'A',5,'GARAJE',15.1,'99888888M',NULL);
INSERT INTO HUECO VALUES(22,'Laredo',3,3,'A',20,'GARAJE',14.6,'99888888M',NULL);
INSERT INTO HUECO VALUES(23,'Laredo',3,3,'A',5,'BODEGA',10.5,'99888888M',NULL);
INSERT INTO HUECO VALUES(24,'Damasco',3,1,'A',1,'GARAJE',14.6,'11111122A',NULL);
INSERT INTO HUECO VALUES(25,'Damasco',3,1,'B',2,'GARAJE',14.4,'22222211B',NULL);
INSERT INTO HUECO VALUES(33,'Damasco',3,1,'B',10,'TRASTERO',10.4,'22222211B','Tiene dos enchufes');
INSERT INTO HUECO VALUES(26,'Damasco',3,1,'C',3,'GARAJE',14,'11111122A',NULL);
INSERT INTO HUECO VALUES(34,'Damasco',3,1,'C',15,'GARAJE',14.3,'11111122A',NULL);
INSERT INTO HUECO VALUES(27,'Damasco',3,2,'A',4,'GARAJE',13.1,'33333344C',NULL);
INSERT INTO HUECO VALUES(28,'Damasco',3,2,'B',5,'GARAJE',12.4,'99999966L',NULL);
INSERT INTO HUECO VALUES(29,'Damasco',3,3,'A',6,'GARAJE',12.3,'11111122A',NULL);
INSERT INTO HUECO VALUES(30,'Damasco',3,3,'B',7,'GARAJE',13.1,'55555511E',NULL);
INSERT INTO HUECO VALUES(31,'Damasco',3,4,'A',8,'GARAJE',14.6,'55555511E',NULL);
INSERT INTO HUECO VALUES(35,'Damasco',3,4,'A',8,'BODEGA',11,'55555511E',NULL);
INSERT INTO HUECO VALUES(32,'Damasco',3,4,'B',9,'GARAJE',14.1,'33333344C',NULL);
INSERT INTO HUECO VALUES(36,'Damasco',3,4,'B',19,'GARAJE',12.4,'33333344C',NULL);
INSERT INTO HUECO VALUES(37,'Damasco',3,4,'B',18,'GARAJE',13.3,'33333344C',NULL);
INSERT INTO HUECO VALUES(38,'Alegria',44,1,'A',1,'GARAJE',12.3,'88888822H',NULL);
INSERT INTO HUECO VALUES(39,'Alegria',44,1,'B',2,'GARAJE',13,'88888822H',NULL);
INSERT INTO HUECO VALUES(40,'Alegria',44,2,'A',3,'GARAJE',14.1,'22222211B',NULL);
INSERT INTO HUECO VALUES(41,'Alegria',44,1,'A',1,'TRASTERO',9.3,'88888822H',NULL);
INSERT INTO HUECO VALUES(42,'Alegria',44,1,'B',2,'TRASTERO',11.2,'88888822H',NULL);
INSERT INTO HUECO VALUES(43,'Alegria',44,2,'A',3,'TRASTERO',8.1,'22222211B',NULL);
INSERT INTO HUECO VALUES(44,'Zurbarán',101,NULL,NULL,39,'GARAJE',14.4,NULL,NULL);
INSERT INTO HUECO VALUES(45,'Zurbarán',101,NULL,NULL,38,'GARAJE',14.4,NULL,NULL);
INSERT INTO HUECO VALUES(46,'Zurbarán',101,NULL,NULL,36,'GARAJE',14.4,NULL,NULL);
INSERT INTO HUECO VALUES(47,'Alegria',44,NULL,NULL,6,'GARAJE',13.4,'99999966L',NULL);
INSERT INTO HUECO VALUES(48,'Alegria',44,NULL,NULL,8,'GARAJE',12.7,NULL,NULL);
INSERT INTO HUECO VALUES(49,'Damasco',3,NULL,NULL,20,'GARAJE',12.3,NULL,NULL);
INSERT INTO HUECO VALUES(50,'Damasco',3,NULL,NULL,21,'GARAJE',14.5,NULL,NULL);
INSERT INTO HUECO VALUES(51,'Damasco',3,NULL,NULL,22,'GARAJE',13.7,'88888822H',NULL);
INSERT INTO HUECO VALUES(52,'Laredo',3,NULL,NULL,25,'GARAJE',14.2,'88888822H',NULL);

